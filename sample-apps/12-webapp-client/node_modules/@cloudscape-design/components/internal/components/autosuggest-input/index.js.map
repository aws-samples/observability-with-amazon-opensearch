{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/internal/components/autosuggest-input/index.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport React, { Ref, useRef, useState, useImperativeHandle, useEffect } from 'react';\n\nimport Dropdown from '../dropdown';\n\nimport { FormFieldValidationControlProps, useFormFieldContext } from '../../context/form-field-context';\nimport { BaseComponentProps, getBaseProps } from '../../base-component';\nimport {\n  BaseKeyDetail,\n  fireCancelableEvent,\n  fireNonCancelableEvent,\n  getBlurEventRelatedTarget,\n  NonCancelableEventHandler,\n} from '../../events';\nimport InternalInput from '../../../input/internal';\nimport { BaseChangeDetail, BaseInputProps, InputKeyEvents, InputProps } from '../../../input/interfaces';\nimport { getFocusables } from '../focus-lock/utils';\nimport { ExpandToViewport } from '../dropdown/interfaces';\nimport { InternalBaseComponentProps } from '../../hooks/use-base-component';\nimport { KeyCode } from '../../keycode';\nimport styles from './styles.css.js';\nimport clsx from 'clsx';\n\nexport interface AutosuggestInputProps\n  extends BaseComponentProps,\n    BaseInputProps,\n    InputKeyEvents,\n    FormFieldValidationControlProps,\n    ExpandToViewport,\n    InternalBaseComponentProps {\n  ariaControls?: string;\n  ariaActivedescendant?: string;\n  dropdownExpanded?: boolean;\n  dropdownContentKey?: string;\n  dropdownContent?: React.ReactNode;\n  dropdownFooter?: React.ReactNode;\n  dropdownWidth?: number;\n  onDropdownMouseDown?: React.MouseEventHandler;\n  onCloseDropdown?: NonCancelableEventHandler<null>;\n  onDelayedInput?: NonCancelableEventHandler<BaseChangeDetail>;\n  onPressArrowDown?: () => void;\n  onPressArrowUp?: () => void;\n  onPressEnter?: () => boolean;\n}\n\nexport interface AutosuggestInputFocusOptions {\n  preventDropdown?: boolean;\n}\n\nexport interface AutosuggestInputRef extends InputProps.Ref {\n  focus(options?: AutosuggestInputFocusOptions): void;\n  open(): void;\n  close(): void;\n}\n\nconst AutosuggestInput = React.forwardRef(\n  (\n    {\n      value,\n      onChange,\n      onBlur,\n      onFocus,\n      onKeyUp,\n      onKeyDown,\n      name,\n      placeholder,\n      disabled,\n      readOnly,\n      autoFocus,\n      ariaLabel,\n      ariaRequired,\n      disableBrowserAutocorrect = false,\n      expandToViewport,\n      ariaControls,\n      ariaActivedescendant,\n      dropdownExpanded,\n      dropdownContentKey,\n      dropdownContent = null,\n      dropdownFooter = null,\n      dropdownWidth,\n      onDropdownMouseDown,\n      onCloseDropdown,\n      onDelayedInput,\n      onPressArrowDown,\n      onPressArrowUp,\n      onPressEnter,\n      __internalRootRef,\n      ...restProps\n    }: AutosuggestInputProps,\n    ref: Ref<AutosuggestInputRef>\n  ) => {\n    const baseProps = getBaseProps(restProps);\n    const formFieldContext = useFormFieldContext(restProps);\n\n    const inputRef = useRef<HTMLInputElement>(null);\n    const dropdownContentRef = useRef<HTMLDivElement>(null);\n    const dropdownFooterRef = useRef<HTMLDivElement>(null);\n    const preventOpenOnFocusRef = useRef(false);\n\n    const [open, setOpen] = useState(false);\n\n    const openDropdown = () => !readOnly && setOpen(true);\n\n    const closeDropdown = () => {\n      setOpen(false);\n      fireNonCancelableEvent(onCloseDropdown, null);\n    };\n\n    useImperativeHandle(ref, () => ({\n      focus(options?: AutosuggestInputFocusOptions) {\n        if (options?.preventDropdown) {\n          preventOpenOnFocusRef.current = true;\n        }\n        inputRef.current?.focus();\n      },\n      select() {\n        inputRef.current?.select();\n      },\n      open: openDropdown,\n      close: closeDropdown,\n    }));\n\n    const handleBlur: React.FocusEventHandler = event => {\n      const relatedTarget = getBlurEventRelatedTarget(event.nativeEvent);\n      if (\n        event.currentTarget.contains(relatedTarget) ||\n        dropdownContentRef.current?.contains(relatedTarget) ||\n        dropdownFooterRef.current?.contains(relatedTarget)\n      ) {\n        return;\n      }\n      closeDropdown();\n      fireNonCancelableEvent(onBlur, null);\n    };\n\n    const handleFocus = () => {\n      if (!preventOpenOnFocusRef.current) {\n        openDropdown();\n        fireNonCancelableEvent(onFocus, null);\n      }\n      preventOpenOnFocusRef.current = false;\n    };\n\n    const handleKeyDown = (e: CustomEvent<BaseKeyDetail>) => {\n      switch (e.detail.keyCode) {\n        case KeyCode.down: {\n          onPressArrowDown?.();\n          openDropdown();\n          e.preventDefault();\n          break;\n        }\n        case KeyCode.up: {\n          onPressArrowUp?.();\n          openDropdown();\n          e.preventDefault();\n          break;\n        }\n        case KeyCode.enter: {\n          if (open) {\n            if (!onPressEnter?.()) {\n              closeDropdown();\n            }\n            e.preventDefault();\n          }\n          fireCancelableEvent(onKeyDown, e.detail);\n          break;\n        }\n        case KeyCode.escape: {\n          if (open) {\n            closeDropdown();\n          } else if (value) {\n            fireNonCancelableEvent(onChange, { value: '' });\n          }\n          e.preventDefault();\n          fireCancelableEvent(onKeyDown, e.detail);\n          break;\n        }\n        default: {\n          fireCancelableEvent(onKeyDown, e.detail);\n        }\n      }\n    };\n\n    const handleChange = (value: string) => {\n      openDropdown();\n      fireNonCancelableEvent(onChange, { value });\n    };\n\n    const handleDelayedInput = (value: string) => {\n      fireNonCancelableEvent(onDelayedInput, { value });\n    };\n\n    const expanded = open && (dropdownExpanded ?? !!dropdownContent);\n    const nativeAttributes = {\n      name,\n      placeholder,\n      autoFocus,\n      onClick: openDropdown,\n      role: 'combobox',\n      'aria-autocomplete': 'list',\n      'aria-expanded': expanded,\n      'aria-controls': ariaControls,\n      // 'aria-owns' needed for safari+vo to announce activedescendant content\n      'aria-owns': ariaControls,\n      'aria-label': ariaLabel,\n      'aria-activedescendant': ariaActivedescendant,\n    };\n\n    const [trapDropdownFocus, setTrapDropdownFocus] = useState(false);\n\n    // Run this effect on every render to determine if necessary to trap focus around input and dropdown.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    useEffect(() => {\n      setTrapDropdownFocus(\n        (dropdownFooterRef.current ? getFocusables(dropdownFooterRef.current).length > 0 : false) ||\n          (dropdownContentRef.current ? getFocusables(dropdownContentRef.current).length > 0 : false)\n      );\n    });\n\n    return (\n      <div\n        {...baseProps}\n        className={clsx(baseProps.className, styles.root)}\n        ref={__internalRootRef}\n        onBlur={handleBlur}\n      >\n        <Dropdown\n          minWidth={dropdownWidth}\n          stretchWidth={!dropdownWidth}\n          contentKey={dropdownContentKey}\n          trigger={\n            <InternalInput\n              type=\"search\"\n              value={value}\n              onChange={event => handleChange(event.detail.value)}\n              __onDelayedInput={event => handleDelayedInput(event.detail.value)}\n              onFocus={handleFocus}\n              onKeyDown={handleKeyDown}\n              onKeyUp={onKeyUp}\n              disabled={disabled}\n              disableBrowserAutocorrect={disableBrowserAutocorrect}\n              readOnly={readOnly}\n              ariaRequired={ariaRequired}\n              ref={inputRef}\n              autoComplete={false}\n              __nativeAttributes={nativeAttributes}\n              {...formFieldContext}\n            />\n          }\n          onMouseDown={onDropdownMouseDown}\n          open={open}\n          footer={\n            dropdownFooterRef && (\n              <div ref={dropdownFooterRef} className={styles['dropdown-footer']}>\n                {dropdownFooter}\n              </div>\n            )\n          }\n          expandToViewport={expandToViewport}\n          hasContent={expanded}\n          trapFocus={trapDropdownFocus}\n        >\n          <div ref={dropdownContentRef} className={styles['dropdown-content']}>\n            {open && dropdownContent}\n          </div>\n        </Dropdown>\n      </div>\n    );\n  }\n);\n\nexport default AutosuggestInput;\n"]}