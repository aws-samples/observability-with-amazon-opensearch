{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/s3-resource-selector/s3-modal/index.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useReducer, useRef } from 'react';\nimport InternalBreadcrumbGroup from '../../breadcrumb-group/internal';\nimport { InternalButton } from '../../button/internal';\nimport InternalModal from '../../modal/internal';\nimport InternalSpaceBetween from '../../space-between/internal';\nimport { ForwardFocusRef } from '../../internal/hooks/forward-focus';\nimport { useEffectOnUpdate } from '../../internal/hooks/use-effect-on-update';\nimport { useVisualRefresh } from '../../internal/hooks/use-visual-mode';\nimport { S3ResourceSelectorProps } from '../interfaces';\nimport { BucketsTable } from './buckets-table';\nimport { ObjectsTable } from './objects-table';\nimport { VersionsTable } from './versions-table';\nimport styles from './styles.css.js';\nimport { joinObjectPath } from '../utils';\n\nexport interface S3ModalProps {\n  alert: React.ReactNode;\n  selectableItemsTypes: S3ResourceSelectorProps['selectableItemsTypes'];\n  fetchBuckets: S3ResourceSelectorProps['fetchBuckets'];\n  bucketsVisibleColumns: ReadonlyArray<string>;\n  bucketsIsItemDisabled: S3ResourceSelectorProps['bucketsIsItemDisabled'];\n  fetchObjects: S3ResourceSelectorProps['fetchObjects'];\n  objectsVisibleColumns: ReadonlyArray<string>;\n  objectsIsItemDisabled: S3ResourceSelectorProps['objectsIsItemDisabled'];\n  fetchVersions: S3ResourceSelectorProps['fetchVersions'];\n  versionsVisibleColumns: ReadonlyArray<string>;\n  versionsIsItemDisabled: S3ResourceSelectorProps['versionsIsItemDisabled'];\n  i18nStrings: S3ResourceSelectorProps.I18nStrings | undefined;\n  onDismiss: () => void;\n  onSubmit: (resource: S3ResourceSelectorProps.Resource) => void;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction assertNever(_value: never) {\n  return null;\n}\n\ninterface S3BrowseState {\n  selectedItem: string | null;\n  currentView: 'buckets' | 'objects' | 'versions';\n  breadcrumbs: ReadonlyArray<string>;\n}\n\ntype S3BrowseActions =\n  | { type: 'browse-buckets' }\n  | { type: 'browse-objects' | 'browse-versions'; breadcrumbs: S3BrowseState['breadcrumbs'] }\n  | { type: 'select-item'; item: string };\n\nconst initialBrowseState: S3BrowseState = {\n  selectedItem: null,\n  currentView: 'buckets',\n  breadcrumbs: [],\n};\n\nfunction s3BrowseReducer(state: S3BrowseState, action: S3BrowseActions) {\n  switch (action.type) {\n    case 'browse-buckets':\n      return initialBrowseState;\n    case 'browse-objects':\n      return {\n        selectedItem: null,\n        currentView: 'objects' as const,\n        breadcrumbs: action.breadcrumbs,\n      };\n    case 'browse-versions':\n      return {\n        selectedItem: null,\n        currentView: 'versions' as const,\n        breadcrumbs: action.breadcrumbs,\n      };\n    case 'select-item':\n      return {\n        ...state,\n        selectedItem: action.item,\n      };\n    default:\n      assertNever(action);\n  }\n  return state;\n}\n\nfunction createResourceInfo({ currentView, breadcrumbs, selectedItem }: S3BrowseState) {\n  const prefix = 's3://';\n  if (currentView === 'versions') {\n    return { uri: prefix + joinObjectPath(breadcrumbs), versionId: selectedItem ?? undefined };\n  }\n  return { uri: prefix + joinObjectPath([...breadcrumbs, selectedItem!]) };\n}\n\nexport function S3Modal({\n  i18nStrings,\n  alert,\n  selectableItemsTypes,\n  fetchBuckets,\n  bucketsVisibleColumns,\n  bucketsIsItemDisabled,\n  fetchObjects,\n  objectsVisibleColumns,\n  objectsIsItemDisabled,\n  fetchVersions,\n  versionsVisibleColumns,\n  versionsIsItemDisabled,\n  onSubmit,\n  onDismiss,\n}: S3ModalProps) {\n  const [{ currentView, breadcrumbs, selectedItem }, dispatch] = useReducer(s3BrowseReducer, initialBrowseState);\n  const forwardFocusRef = useRef<ForwardFocusRef>(null);\n\n  const modalWrapperRef = useRef(null);\n  const isVisualRefresh = useVisualRefresh(modalWrapperRef);\n\n  useEffectOnUpdate(() => {\n    forwardFocusRef.current?.focus();\n  }, [breadcrumbs]);\n\n  return (\n    <div ref={modalWrapperRef}>\n      <InternalModal\n        visible={true}\n        size=\"max\"\n        closeAriaLabel={i18nStrings?.labelModalDismiss ?? ''}\n        onDismiss={onDismiss}\n        header={i18nStrings?.modalTitle}\n        footer={\n          <InternalSpaceBetween className={styles['modal-actions']} size=\"xs\" direction=\"horizontal\">\n            <InternalButton variant=\"link\" formAction=\"none\" onClick={onDismiss}>\n              {i18nStrings?.modalCancelButton}\n            </InternalButton>\n            <InternalButton\n              variant=\"primary\"\n              className={styles['submit-button']}\n              disabled={!selectedItem}\n              formAction=\"none\"\n              onClick={() => onSubmit(createResourceInfo({ currentView, breadcrumbs, selectedItem }))}\n            >\n              {i18nStrings?.modalSubmitButton}\n            </InternalButton>\n          </InternalSpaceBetween>\n        }\n      >\n        <InternalSpaceBetween size={isVisualRefresh ? 'xxs' : 'xs'}>\n          <InternalBreadcrumbGroup\n            ariaLabel={i18nStrings?.labelBreadcrumbs}\n            expandAriaLabel=\"Show path\"\n            onFollow={event => {\n              event.preventDefault();\n              event.detail.item.meta.onClick();\n            }}\n            items={[\n              {\n                text: i18nStrings?.modalBreadcrumbRootItem ?? '',\n                href: '',\n                meta: { onClick: () => dispatch({ type: 'browse-buckets' }) },\n              },\n              ...breadcrumbs.map((segment, index) => ({\n                text: segment,\n                href: '',\n                meta: {\n                  onClick: () =>\n                    dispatch({\n                      type: 'browse-objects',\n                      breadcrumbs: breadcrumbs.slice(0, index + 1),\n                    }),\n                },\n              })),\n            ]}\n          />\n          {alert}\n          {currentView === 'buckets' ? (\n            <BucketsTable\n              forwardFocusRef={forwardFocusRef}\n              fetchData={fetchBuckets}\n              visibleColumns={bucketsVisibleColumns}\n              isItemDisabled={bucketsIsItemDisabled}\n              selectableItemsTypes={selectableItemsTypes}\n              i18nStrings={i18nStrings}\n              isVisualRefresh={isVisualRefresh}\n              onDrilldown={path =>\n                dispatch({\n                  type: 'browse-objects',\n                  breadcrumbs: [path],\n                })\n              }\n              onSelect={item => dispatch({ type: 'select-item', item })}\n            />\n          ) : currentView === 'objects' ? (\n            <ObjectsTable\n              forwardFocusRef={forwardFocusRef}\n              pathSegments={breadcrumbs}\n              fetchData={fetchObjects}\n              visibleColumns={objectsVisibleColumns}\n              isItemDisabled={objectsIsItemDisabled}\n              selectableItemsTypes={selectableItemsTypes}\n              i18nStrings={i18nStrings}\n              isVisualRefresh={isVisualRefresh}\n              onDrilldown={item => {\n                dispatch({\n                  type: item.IsFolder ? 'browse-objects' : 'browse-versions',\n                  breadcrumbs: [...breadcrumbs, item.Key!],\n                });\n              }}\n              onSelect={item => dispatch({ type: 'select-item', item })}\n            />\n          ) : currentView === 'versions' ? (\n            <VersionsTable\n              forwardFocusRef={forwardFocusRef}\n              pathSegments={breadcrumbs}\n              fetchData={fetchVersions}\n              visibleColumns={versionsVisibleColumns}\n              isItemDisabled={versionsIsItemDisabled}\n              i18nStrings={i18nStrings}\n              isVisualRefresh={isVisualRefresh}\n              onSelect={item => dispatch({ type: 'select-item', item })}\n            />\n          ) : (\n            assertNever(currentView)\n          )}\n        </InternalSpaceBetween>\n      </InternalModal>\n    </div>\n  );\n}\n"]}