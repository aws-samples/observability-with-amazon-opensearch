{"version":3,"file":"use-announcement.js","sourceRoot":"","sources":["../../../../src/select/utils/use-announcement.ts"],"names":[],"mappings":"AAIA,OAAO,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,OAAO,CAAC;AAC1C,OAAO,wBAAwB,MAAM,mDAAmD,CAAC;AAMzF;;;;;GAKG;AACH,MAAM,UAAU,eAAe,CAA8B,EAY5D;QAXC,gBAAgB,sBAAA,EAChB,iBAAiB,uBAAA,EACjB,SAAS,eAAA,EACT,iBAAiB,uBAAA,EACjB,yBAAyB,+BAAA;IAQzB,IAAM,kBAAkB,GAAG,MAAM,CAA0B,SAAS,CAAC,CAAC;IAEtE,iGAAiG;IACjG,SAAS,CAAC;QACR,IAAI,iBAAiB,EAAE;YACrB,IAAM,SAAO,GAAG,qBAAqB,CAAC;gBACpC,kBAAkB,CAAC,OAAO,GAAG,SAAS,CAAC,iBAAiB,CAAC,CAAC;YAC5D,CAAC,CAAC,CAAC;YACH,OAAO,cAAM,OAAA,oBAAoB,CAAC,SAAO,CAAC,EAA7B,CAA6B,CAAC;SAC5C;IACH,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,iBAAiB,EAAE;QACtB,OAAO,EAAE,CAAC;KACX;IAED,IAAM,MAAM,GAAG,iBAAiB,CAAC,MAA0B,CAAC;IAC5D,IAAM,MAAM,GAAG,SAAS,CAAC,iBAAiB,CAAC,CAAC;IAC5C,0EAA0E;IAC1E,IAAM,KAAK,GAAG,MAAM,IAAI,MAAM,KAAK,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC;IAEnF,mCAAmC;IACnC,IAAI,yBAAyB,EAAE;QAC7B,OAAO,yBAAyB,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;KACjD;IAED,yEAAyE;IACzE,IAAM,cAAc,GAAG,gBAAgB,IAAI,iBAAiB,CAAC,CAAC,CAAC,iBAAiB,CAAC,CAAC,CAAC,EAAE,CAAC;IACtF,IAAM,kBAAkB,GAAG,wBAAwB,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;IACnE,OAAO,CAAC,cAAc,EAAE,kBAAkB,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACxE,CAAC","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { OptionDefinition, OptionGroup } from '../../internal/components/option/interfaces';\nimport { SelectProps } from '../interfaces';\nimport { useEffect, useRef } from 'react';\nimport defaultOptionDescription from '../../internal/components/option/option-announcer';\n\ninterface OptionHolder {\n  option?: OptionDefinition | OptionGroup;\n}\n\n/**\n * The hook produces the live region string to be announced when an option is highlighted.\n * This is a workaround to account for the issues with assistive technologies.\n *\n * If the testing reveals no issues with the native announcements the live-region can be removed.\n */\nexport function useAnnouncement<Option extends OptionHolder>({\n  announceSelected,\n  highlightedOption,\n  getParent,\n  selectedAriaLabel,\n  renderHighlightedAriaLive,\n}: {\n  announceSelected: boolean;\n  highlightedOption?: Option;\n  getParent: (option: Option) => undefined | OptionGroup;\n  selectedAriaLabel?: string;\n  renderHighlightedAriaLive?: SelectProps.ContainingOptionAndGroupString;\n}) {\n  const prevAnnouncedGroup = useRef<OptionGroup | undefined>(undefined);\n\n  // Record previously announced group with a delay to account for possible re-renders of the hook.\n  useEffect(() => {\n    if (highlightedOption) {\n      const frameId = requestAnimationFrame(() => {\n        prevAnnouncedGroup.current = getParent(highlightedOption);\n      });\n      return () => cancelAnimationFrame(frameId);\n    }\n  });\n\n  if (!highlightedOption) {\n    return '';\n  }\n\n  const option = highlightedOption.option as OptionDefinition;\n  const parent = getParent(highlightedOption);\n  // Only announce parent group if it wasn't announced with previous option.\n  const group = parent && parent !== prevAnnouncedGroup.current ? parent : undefined;\n\n  // Use custom renderer if provided.\n  if (renderHighlightedAriaLive) {\n    return renderHighlightedAriaLive(option, group);\n  }\n\n  // Use default renderer with selected ARIA label if defined and relevant.\n  const selectedPrefix = announceSelected && selectedAriaLabel ? selectedAriaLabel : '';\n  const defaultDescription = defaultOptionDescription(option, group);\n  return [selectedPrefix, defaultDescription].filter(Boolean).join(' ');\n}\n"]}