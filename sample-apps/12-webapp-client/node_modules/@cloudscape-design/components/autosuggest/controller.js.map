{"version":3,"file":"controller.js","sourceRoot":"","sources":["../../../src/autosuggest/controller.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useCallback, useMemo } from 'react';\nimport { CancelableEventHandler, BaseKeyDetail } from '../internal/events';\nimport { filterOptions } from './utils/utils';\nimport { KeyCode } from '../internal/keycode';\nimport { generateTestIndexes } from '../internal/components/options-list/utils/test-indexes';\nimport { AutosuggestItem, AutosuggestProps } from './interfaces';\n\ntype Options = AutosuggestProps.Options;\n\nconst parentMap = new WeakMap<AutosuggestItem, AutosuggestItem>();\nexport const getParentGroup = (item: AutosuggestItem) => parentMap.get(item);\n\nexport const useAutosuggestItems = (options: Options = []) => {\n  return useMemo(() => createItems(options), [options]);\n};\n\nfunction createItems(options: Options): AutosuggestItem[] {\n  const items: AutosuggestItem[] = [];\n  for (const option of options) {\n    if (isGroup(option)) {\n      items.push(...flattenGroup(option));\n    } else {\n      items.push({ ...option, option });\n    }\n  }\n  return items;\n}\n\nfunction isGroup(optionOrGroup: AutosuggestProps.Option): optionOrGroup is AutosuggestProps.OptionGroup {\n  return 'options' in optionOrGroup;\n}\n\nfunction flattenGroup(group: AutosuggestProps.OptionGroup): AutosuggestItem[] {\n  const { options, ...rest } = group;\n  const hasOnlyDisabledChildren = options.every(option => option.disabled);\n  const parent: AutosuggestItem = {\n    ...rest,\n    type: 'parent',\n    disabled: rest.disabled || hasOnlyDisabledChildren,\n    option: group,\n  };\n  const children: AutosuggestItem[] = options.map(option => ({\n    ...option,\n    type: 'child',\n    disabled: option.disabled || parent.disabled,\n    option,\n  }));\n  // TODO: Refactor parentMap and remove this side effect\n  children.forEach(child => parentMap.set(child, { ...group, option: group }));\n  return [parent].concat(children);\n}\n\nexport const useFilteredItems = (\n  autosuggestItems: AutosuggestItem[],\n  value: string,\n  filterText: string,\n  filteringType: AutosuggestProps.FilteringType,\n  showAll: boolean,\n  __hideEnteredTextLabel?: boolean\n) =>\n  useMemo(() => {\n    const filteredItems =\n      filteringType === 'auto' && !showAll ? filterOptions(autosuggestItems, filterText) : [...autosuggestItems];\n    if (value && !__hideEnteredTextLabel) {\n      filteredItems.unshift({ value, type: 'use-entered', option: { value } });\n    }\n    generateTestIndexes(filteredItems, getParentGroup);\n    return filteredItems;\n  }, [autosuggestItems, value, filterText, filteringType, showAll, __hideEnteredTextLabel]);\n\nexport const useSelectVisibleOption = (\n  filteredItems: AutosuggestItem[],\n  selectOption: (option: AutosuggestItem) => void,\n  isInteractive: (option: AutosuggestItem) => boolean\n) =>\n  useCallback(\n    (index: number) => {\n      const option = filteredItems[index];\n      if (option && isInteractive(option)) {\n        selectOption(option);\n      }\n    },\n    [filteredItems, selectOption, isInteractive]\n  );\n\nexport const useHighlightVisibleOption = (\n  filteredItems: AutosuggestItem[],\n  setHighlightedIndex: (index: number) => void,\n  isHighlightable: (option: AutosuggestItem) => boolean\n) =>\n  useCallback(\n    (index: number) => {\n      const option = filteredItems[index];\n      if (option && isHighlightable(option)) {\n        setHighlightedIndex(index);\n      }\n    },\n    [filteredItems, setHighlightedIndex, isHighlightable]\n  );\n\nexport const useKeyboardHandler = (\n  moveHighlight: (direction: -1 | 1) => void,\n  openDropdown: () => void,\n  selectHighlighted: () => void,\n  usingMouse: React.MutableRefObject<boolean>,\n  open: boolean,\n  onKeyDown?: CancelableEventHandler<BaseKeyDetail>\n) => {\n  return useCallback(\n    (e: CustomEvent<BaseKeyDetail>) => {\n      switch (e.detail.keyCode) {\n        case KeyCode.down: {\n          moveHighlight(1);\n          openDropdown();\n          usingMouse.current = false;\n          e.preventDefault();\n          break;\n        }\n        case KeyCode.up: {\n          moveHighlight(-1);\n          openDropdown();\n          usingMouse.current = false;\n          e.preventDefault();\n          break;\n        }\n        case KeyCode.enter: {\n          if (open) {\n            selectHighlighted();\n            e.preventDefault();\n          }\n          onKeyDown && onKeyDown(e);\n          break;\n        }\n        default: {\n          onKeyDown && onKeyDown(e);\n        }\n      }\n    },\n    [moveHighlight, selectHighlighted, onKeyDown, usingMouse, open, openDropdown]\n  );\n};\n"]}