{"version":3,"file":"internal.js","sourceRoot":"","sources":["../../../src/modal/internal.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useEffect, useRef } from 'react';\nimport FocusLock from 'react-focus-lock';\nimport { useMergeRefs } from '../internal/hooks/use-merge-refs';\nimport clsx from 'clsx';\n\nimport { getBaseProps } from '../internal/base-component';\nimport { InternalBaseComponentProps } from '../internal/hooks/use-base-component';\nimport { fireNonCancelableEvent } from '../internal/events';\nimport { KeyCode } from '../internal/keycode';\nimport { useUniqueId } from '../internal/hooks/use-unique-id';\nimport { InternalButton } from '../button/internal';\nimport InternalHeader from '../header/internal';\nimport Portal from '../internal/components/portal';\nimport { useContainerBreakpoints } from '../internal/hooks/container-queries';\nimport { useVisualRefresh } from '../internal/hooks/use-visual-mode';\n\nimport { disableBodyScrolling, enableBodyScrolling } from './body-scroll';\nimport { ModalProps } from './interfaces';\nimport styles from './styles.css.js';\nimport { SomeRequired } from '../internal/types';\n\ntype InternalModalProps = SomeRequired<ModalProps, 'size' | 'closeAriaLabel'> & InternalBaseComponentProps;\n\nexport default function InternalModal({\n  size,\n  visible,\n  closeAriaLabel,\n  header,\n  children,\n  footer,\n  disableContentPaddings,\n  onDismiss,\n  modalRoot,\n  __internalRootRef = null,\n  ...rest\n}: InternalModalProps) {\n  const instanceUniqueId = useUniqueId();\n  const headerId = `${rest.id || instanceUniqueId}-header`;\n  const focusLockRef = useRef<HTMLDivElement>(null);\n  const lastMouseDownElementRef = useRef<HTMLElement | null>(null);\n  const initiallyFocusedElementRef = useRef<HTMLElement | null>(null);\n  const [breakpoint, breakpointsRef] = useContainerBreakpoints(['xs']);\n\n  const refObject = useRef<HTMLDivElement>(null);\n  const mergedRef = useMergeRefs(breakpointsRef, refObject, __internalRootRef);\n\n  const isRefresh = useVisualRefresh(useRef(modalRoot ?? document.body));\n\n  const baseProps = getBaseProps(rest);\n\n  // enable body scroll and restore focus if unmounting while visible\n  useEffect(() => {\n    return () => {\n      enableBodyScrolling();\n    };\n  }, []);\n\n  // enable / disable body scroll\n  useEffect(() => {\n    if (visible) {\n      disableBodyScrolling();\n    } else {\n      enableBodyScrolling();\n    }\n  }, [visible]);\n\n  // Because we hide the element with styles (and not actually detach it from DOM), we need to scroll to top\n  useEffect(() => {\n    if (visible && refObject.current) {\n      refObject.current.scrollTop = 0;\n    }\n  }, [refObject, visible]);\n\n  // Handle focus restore\n  const onActivation = () => {\n    initiallyFocusedElementRef.current = document.activeElement as HTMLElement;\n  };\n\n  const onDeactivation = () => {\n    initiallyFocusedElementRef.current?.focus();\n    initiallyFocusedElementRef.current = null;\n  };\n\n  const dismiss = (reason: string) => fireNonCancelableEvent(onDismiss, { reason });\n\n  const onOverlayMouseDown = (event: React.MouseEvent) => {\n    lastMouseDownElementRef.current = event.target as HTMLElement;\n  };\n  const onOverlayClick = (event: React.MouseEvent) => {\n    const overlay = refObject.current;\n    const lastClicked = lastMouseDownElementRef.current;\n\n    if (event.target === overlay && lastClicked === overlay) {\n      dismiss('overlay');\n    }\n  };\n  const onCloseButtonClick = () => dismiss('closeButton');\n  const escKeyHandler = (event: React.KeyboardEvent) => {\n    if (event.keyCode === KeyCode.escape) {\n      dismiss('keyboard');\n    }\n  };\n\n  return (\n    <Portal container={modalRoot}>\n      <div\n        {...baseProps}\n        className={clsx(styles.root, { [styles.hidden]: !visible }, baseProps.className, isRefresh && styles.refresh)}\n        role=\"dialog\"\n        aria-modal={true}\n        aria-labelledby={headerId}\n        onMouseDown={onOverlayMouseDown}\n        onClick={onOverlayClick}\n        ref={mergedRef}\n      >\n        <FocusLock\n          disabled={!visible}\n          autoFocus={true}\n          className={styles['focus-lock']}\n          ref={focusLockRef}\n          onActivation={onActivation}\n          onDeactivation={onDeactivation}\n        >\n          <div\n            className={clsx(\n              styles.dialog,\n              styles[size],\n              styles[`breakpoint-${breakpoint}`],\n              isRefresh && styles.refresh\n            )}\n            onKeyDown={escKeyHandler}\n            tabIndex={-1}\n          >\n            <div className={styles.container}>\n              <div className={styles.header}>\n                <InternalHeader\n                  variant=\"h2\"\n                  __disableActionsWrapping={true}\n                  actions={\n                    <InternalButton\n                      ariaLabel={closeAriaLabel}\n                      className={styles['dismiss-control']}\n                      variant=\"modal-dismiss\"\n                      iconName=\"close\"\n                      formAction=\"none\"\n                      onClick={onCloseButtonClick}\n                    />\n                  }\n                >\n                  <span id={headerId} className={styles['header--text']}>\n                    {header}\n                  </span>\n                </InternalHeader>\n              </div>\n              <div className={clsx(styles.content, { [styles['no-paddings']]: disableContentPaddings })}>\n                {children}\n              </div>\n              {footer && <div className={styles.footer}>{footer}</div>}\n            </div>\n          </div>\n        </FocusLock>\n      </div>\n    </Portal>\n  );\n}\n"]}