{"version":3,"file":"setup-editor.js","sourceRoot":"","sources":["../../../src/code-editor/setup-editor.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React from 'react';\nimport { Ace } from 'ace-builds';\nimport { PaneStatus } from './util';\n\nexport function setupEditor(\n  ace: any,\n  editor: Ace.Editor,\n  setAnnotations: React.Dispatch<React.SetStateAction<Ace.Annotation[]>>,\n  setCursorPosition: React.Dispatch<React.SetStateAction<Ace.Point>>,\n  setHighlightedAnnotation: React.Dispatch<React.SetStateAction<Ace.Annotation | undefined>>,\n  setPaneStatus: React.Dispatch<React.SetStateAction<PaneStatus>>\n) {\n  ace.config.loadModule('ace/ext/language_tools', function () {\n    editor.setOptions({\n      displayIndentGuides: false,\n      enableSnippets: true,\n      enableBasicAutocompletion: true,\n    });\n  });\n\n  editor.setAutoScrollEditorIntoView(true);\n\n  // To display cursor position in status bar\n  editor.session.selection.on('changeCursor', () => {\n    setCursorPosition(editor.getCursorPosition());\n  });\n\n  editor.session.on('changeAnnotation' as any, () => {\n    const editorAnnotations = editor.session.getAnnotations();\n    const newAnnotations = editorAnnotations.filter(a => a.type !== 'info');\n    if (editorAnnotations.length !== newAnnotations.length) {\n      editor.session.setAnnotations(newAnnotations);\n    }\n    setAnnotations(newAnnotations);\n  });\n\n  editor.commands.addCommand({\n    name: 'exitCodeEditor',\n    bindKey: 'Esc',\n    exec: () => {\n      editor.container.focus();\n    },\n  });\n\n  editor.on('focus', () => {\n    (editor as any).textInput.getElement().setAttribute('tabindex', 0);\n  });\n\n  editor.on('blur', () => {\n    (editor as any).textInput.getElement().setAttribute('tabindex', -1);\n  });\n\n  // prevent users to step into editor directly by keyboard\n  (editor as any).textInput.getElement().setAttribute('tabindex', -1);\n\n  editor.commands.removeCommand('showSettingsMenu', false);\n\n  // Prevent default behavior on error/warning icon click\n  editor.on('guttermousedown' as any, (e: any) => {\n    e.stop();\n  });\n\n  const moveCursorToAnnotation = (a: Ace.Annotation) => {\n    if (typeof a.row === 'number') {\n      editor.gotoLine(a.row + 1, a.column || 0, false);\n    }\n  };\n\n  // open error/warning pane when user clicks on gutter icon\n  editor.on('gutterclick' as any, (e: any) => {\n    const { row }: Ace.Point = e.getDocumentPosition();\n    const currentAnnotations = editor.session.getAnnotations().filter(a => a.row === row && a.type !== 'info');\n    const errors = currentAnnotations.filter(a => a.type === 'error');\n    if (errors.length > 0) {\n      setHighlightedAnnotation(errors[0]);\n      setPaneStatus('error');\n      moveCursorToAnnotation(errors[0]);\n    } else if (currentAnnotations.length > 0) {\n      setHighlightedAnnotation(currentAnnotations[0]);\n      setPaneStatus('warning');\n      moveCursorToAnnotation(currentAnnotations[0]);\n    } else {\n      setHighlightedAnnotation(undefined);\n      setPaneStatus('hidden');\n      editor.gotoLine(row + 1, 0, false);\n    }\n  });\n\n  // HACK: Wrapped lines are highlighted individually. This is seriously the recommended fix.\n  // See: https://github.com/ajaxorg/ace/issues/3067\n  editor.setHighlightActiveLine(false);\n  (editor as any).$updateHighlightActiveLine = function () {\n    const session = this.getSession();\n\n    let highlight;\n    if (this.$highlightActiveLine) {\n      if (this.$selectionStyle !== 'line' || !this.selection.isMultiLine()) {\n        highlight = this.getCursorPosition();\n      }\n      if (this.renderer.$maxLines && this.session.getLength() === 1 && !(this.renderer.$minLines > 1)) {\n        highlight = false;\n      }\n    }\n\n    if (session.$highlightLineMarker && !highlight) {\n      session.removeMarker(session.$highlightLineMarker.id);\n      session.$highlightLineMarker = null;\n    } else if (!session.$highlightLineMarker && highlight) {\n      const range = new ace.Range(highlight.row, 0, highlight.row, Infinity);\n      (range as any).id = session.addMarker(range, 'ace_active-line', 'fullLine');\n      session.$highlightLineMarker = range;\n    } else if (highlight) {\n      session.$highlightLineMarker.start.row = highlight.row;\n      session.$highlightLineMarker.end.row = highlight.row;\n      session.$highlightLineMarker.start.column = 0;\n      session._signal('changeBackMarker');\n    }\n  };\n\n  editor.setHighlightActiveLine(true);\n\n  // HACK: Annotations aren't cleared when editor is empty.\n  editor.on('change', () => {\n    if (editor.getValue().length === 0) {\n      editor.session.clearAnnotations();\n    }\n  });\n\n  // HACK: \"disable\" error tooltips by hiding them as soon as they appear.\n  // See https://github.com/ajaxorg/ace/issues/4004\n  editor.on('showGutterTooltip' as any, (tooltip: any) => {\n    tooltip.hide();\n  });\n}\n"]}