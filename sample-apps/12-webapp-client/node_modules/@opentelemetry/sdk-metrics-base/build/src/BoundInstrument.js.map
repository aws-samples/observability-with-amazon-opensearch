{"version":3,"file":"BoundInstrument.js","sourceRoot":"","sources":["../../src/BoundInstrument.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;GAcG;;;AAEH,4CAA0C;AAC1C,kDAAkD;AAGlD;;;GAGG;AACH,MAAa,mBAAmB;IAG9B,YACE,MAAkB,EACD,SAAkB,EAClB,UAAyB,EACzB,WAAuB;QAFvB,cAAS,GAAT,SAAS,CAAS;QAClB,eAAU,GAAV,UAAU,CAAe;QACzB,gBAAW,GAAX,WAAW,CAAY;QAExC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;IACxB,CAAC;IAED,MAAM,CAAC,KAAa;QAClB,IAAI,IAAI,CAAC,SAAS;YAAE,OAAO;QAC3B,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;YAC7B,UAAI,CAAC,KAAK,CACR,+CAA+C,MAAM,CAAC,MAAM,CAC1D,IAAI,CAAC,OAAO,CACb,GAAG,CACL,CAAC;YACF,OAAO;SACR;QAED,IAAI,IAAI,CAAC,UAAU,KAAK,GAAG,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE;YACrE,UAAI,CAAC,IAAI,CACP,2DAA2D,MAAM,CAAC,MAAM,CACtE,IAAI,CAAC,OAAO,CACb,mCAAmC,CACrC,CAAC;YACF,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;SAC3B;QAED,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACjC,CAAC;IAED,SAAS;QACP,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB,CAAC;IAED,aAAa;QACX,OAAO,IAAI,CAAC,WAAW,CAAC;IAC1B,CAAC;CACF;AA1CD,kDA0CC;AAED;;;GAGG;AACH,MAAa,YACX,SAAQ,mBAAmB;IAE3B,YACE,MAAkB,EAClB,QAAiB,EACjB,SAAwB,EACxB,UAAsB;QAEtB,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU,CAAC,CAAC;IACjD,CAAC;IAED,GAAG,CAAC,KAAa;QACf,IAAI,KAAK,GAAG,CAAC,EAAE;YACb,UAAI,CAAC,KAAK,CAAC,8BAA8B,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;YACxE,OAAO;SACR;QAED,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACrB,CAAC;CACF;AApBD,oCAoBC;AAED;;;;GAIG;AACH,MAAa,kBACX,SAAQ,mBAAmB;IAE3B,YACE,MAAkB,EAClB,QAAiB,EACjB,SAAwB,EACxB,UAAsB;QAEtB,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU,CAAC,CAAC;IACjD,CAAC;IAED,GAAG,CAAC,KAAa;QACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACrB,CAAC;CACF;AAfD,gDAeC;AAED;;GAEG;AACH,MAAa,kBACX,SAAQ,mBAAmB;IAE3B,YACE,MAAkB,EAClB,QAAiB,EACjB,SAAwB,EACxB,UAAsB;QAEtB,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU,CAAC,CAAC;IACjD,CAAC;IAED,MAAM,CAAC,KAAa;QAClB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACrB,CAAC;CACF;AAfD,gDAeC;AAED;;GAEG;AACH,MAAa,aACX,SAAQ,mBAAmB;IAE3B,YACE,MAAkB,EAClB,QAAiB,EACjB,SAAwB,EACxB,UAAsB;QAEtB,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU,CAAC,CAAC;IACjD,CAAC;CACF;AAXD,sCAWC","sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { diag } from '@opentelemetry/api';\nimport * as api from '@opentelemetry/api-metrics';\nimport { Aggregator } from './export/types';\n\n/**\n * This class represent the base to BoundInstrument, which is responsible for generating\n * the TimeSeries.\n */\nexport class BaseBoundInstrument {\n  protected _labels: api.Labels;\n\n  constructor(\n    labels: api.Labels,\n    private readonly _disabled: boolean,\n    private readonly _valueType: api.ValueType,\n    private readonly _aggregator: Aggregator\n  ) {\n    this._labels = labels;\n  }\n\n  update(value: number): void {\n    if (this._disabled) return;\n    if (typeof value !== 'number') {\n      diag.error(\n        `Metric cannot accept a non-number value for ${Object.values(\n          this._labels\n        )}.`\n      );\n      return;\n    }\n\n    if (this._valueType === api.ValueType.INT && !Number.isInteger(value)) {\n      diag.warn(\n        `INT value type cannot accept a floating-point value for ${Object.values(\n          this._labels\n        )}, ignoring the fractional digits.`\n      );\n      value = Math.trunc(value);\n    }\n\n    this._aggregator.update(value);\n  }\n\n  getLabels(): api.Labels {\n    return this._labels;\n  }\n\n  getAggregator(): Aggregator {\n    return this._aggregator;\n  }\n}\n\n/**\n * BoundCounter allows the SDK to observe/record a single metric event. The\n * value of single instrument in the `Counter` associated with specified Labels.\n */\nexport class BoundCounter\n  extends BaseBoundInstrument\n  implements api.BoundCounter {\n  constructor(\n    labels: api.Labels,\n    disabled: boolean,\n    valueType: api.ValueType,\n    aggregator: Aggregator\n  ) {\n    super(labels, disabled, valueType, aggregator);\n  }\n\n  add(value: number): void {\n    if (value < 0) {\n      diag.error(`Counter cannot descend for ${Object.values(this._labels)}`);\n      return;\n    }\n\n    this.update(value);\n  }\n}\n\n/**\n * BoundUpDownCounter allows the SDK to observe/record a single metric event.\n * The value of single instrument in the `UpDownCounter` associated with\n * specified Labels.\n */\nexport class BoundUpDownCounter\n  extends BaseBoundInstrument\n  implements api.BoundCounter {\n  constructor(\n    labels: api.Labels,\n    disabled: boolean,\n    valueType: api.ValueType,\n    aggregator: Aggregator\n  ) {\n    super(labels, disabled, valueType, aggregator);\n  }\n\n  add(value: number): void {\n    this.update(value);\n  }\n}\n\n/**\n * BoundMeasure is an implementation of the {@link BoundMeasure} interface.\n */\nexport class BoundValueRecorder\n  extends BaseBoundInstrument\n  implements api.BoundValueRecorder {\n  constructor(\n    labels: api.Labels,\n    disabled: boolean,\n    valueType: api.ValueType,\n    aggregator: Aggregator\n  ) {\n    super(labels, disabled, valueType, aggregator);\n  }\n\n  record(value: number): void {\n    this.update(value);\n  }\n}\n\n/**\n * BoundObserver is an implementation of the {@link BoundObserver} interface.\n */\nexport class BoundObserver\n  extends BaseBoundInstrument\n  implements api.BoundBaseObserver {\n  constructor(\n    labels: api.Labels,\n    disabled: boolean,\n    valueType: api.ValueType,\n    aggregator: Aggregator\n  ) {\n    super(labels, disabled, valueType, aggregator);\n  }\n}\n"]}